#!/usr/bin/env ruby
require 'net/https'
require 'uri'
require 'openssl'

$url = "https://lvh.me"

load "./vars.rb"

command = <<EOF
curl -vv \
--cacert #{$server_ca_root_publ} \
--key #{$client_priv_nopass} \
--cert #{$client_publ_crt} \
#{$url}
EOF
puts "---------------------------"
puts "EXECUTING:"
puts command
puts "---------------------------"
system(command)

# puts "---------------------------"
# puts "FROM RUBY"
# puts "---------------------------"
#
# uri = URI.parse($url)
# pem = File.read($client_publ_priv_pem)
# http = Net::HTTP.new(uri.host, uri.port)
# http.use_ssl = true
# http.cert = OpenSSL::X509::Certificate.new(pem)
# http.key = OpenSSL::PKey::RSA.new(pem)
# http.verify_mode = OpenSSL::SSL::VERIFY_NONE
#
# request = Net::HTTP::Get.new(uri.request_uri)
# response = http.request(request)
# puts "** RESPONSE(#{response}): "
# puts response.body
